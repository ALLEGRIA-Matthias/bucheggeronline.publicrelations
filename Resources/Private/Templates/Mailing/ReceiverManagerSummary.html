<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:c="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:v="http://typo3.org/ns/FluidTYPO3/Vhs/ViewHelpers"
      v:schemaLocation="https://fluidtypo3.org/schemas/vhs-master.xsd"
      data-namespace-typo3-fluid="true">

<f:layout name="Mailer" />

<f:section name="buttons">
<f:link.action action="show" controller="Mailing" arguments="{mailing:mailing}" class="btn btn-sm btn-default"><svg class="icon icon-sm fill-dark mr-2"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#times"></use></svg>Abbrechen</f:link.action>
</f:section>

<f:section name="content">
    <h1>Empfängermanager <small>Schritt 2 von 3</small></h1>
    <f:flashMessages queueIdentifier="allegria.publicrelations.flashMessages" />
    <h2>Detailauswahl</h2>
    <f:form action="createMails" enctype="multipart/form-data" name="receiver" object="{receiver}" arguments="{mailing:mailing}" class="js-receiver-form">
    <f:form.hidden property="listType" value="{receiver.listType}" />
    <f:form.hidden property="selectedReceiverUids" value="" />

    <p>
      <strong>Vorauswahl: </strong> {receiver.contacts->f:count()} Kontakte
    </p>

    <div class="row g-3 align-items-center mb-4">
        <div class="col">
            <input placeholder="Suche" class="form-control form-control-sm filter-table" 
                  data-filter-table="mailinglists" 
                  data-filter-counter="mailinglists-counter" 
                  data-filter-not="1" 
                  type="search" />
        </div>
        <div class="col-auto">
            <div class="form-control-plaintext" id="mailinglists-counter" data-counter-label="Kontakten">
                {receiver.contacts->f:count()} von {receiver.contacts->f:count()} Kontakten
            </div>
        </div>
    </div>
    <table class="table table-striped table-hover" id="mailinglists">
      <thead>
        <tr>
          <th><input type="checkbox" class="checkbox-toggle-all" checked></th>
          <th>Name</th>
          <th>E-Mail</th>
        </tr>
      </thead>
      <tbody id="mailinglists-to-filter">
      <f:for each="{receiver.contacts -> v:iterator.sort(sortBy: 'last_name')}" as="contact" iteration="ri">
        <tr>
          <td width="30px"><input type="checkbox" name="receiver.{contact.uid}" class="receiver-checkbox" data-uid="{contact.uid}" value="1" checked="checked" /></td>
          <td><f:format.trim>{contact.first_name} <f:if condition="{contact.middle_name}">{contact.middle_name} </f:if>{contact.last_name}</f:format.trim><f:if condition="{contact.company}"> [{contact.company}]</f:if></td>
          <td>{contact.email}</td>
        </tr>
      </f:for>
      </tbody>
    </table>

    <div class="col-12"><f:form.submit value="Empfänger in Liste aufnehmen" class="btn btn-success" /></div>

    </f:form>

</f:section>
</html>
