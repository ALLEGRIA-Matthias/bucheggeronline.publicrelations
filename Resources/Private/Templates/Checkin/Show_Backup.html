<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:c="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers"
      xmlns:v="http://typo3.org/ns/FluidTYPO3/Vhs/ViewHelpers"
      v:schemaLocation="https://fluidtypo3.org/schemas/vhs-master.xsd"
      data-namespace-typo3-fluid="true">

<f:layout name="Checkin" />

<f:section name="buttons">
</f:section>

<f:section name="shortcuts">
<f:link.action action="show" arguments="{event:event}" class="btn btn-default btn-sm"><svg class="icon icon-sm fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#refresh"></use></svg></f:link.action>
</f:section>

<f:section name="content">
<h1>Check-In</h1>
<f:flashMessages queueIdentifier="allegria.publicrelations.flashMessages" />
<p><span class="badge badge-gold">{event.type.title}</span></p>
<h2 class="mt-0">{event.title} <small>am {f:format.date(date:'{event.date}', format:'%d.%m.%Y um %H:%M Uhr')}</small></h2>
<div class="table-fit mb-5">
  <table class="table table-hover">
    <tr>
      <th class="align-top" width="100px">Location:</th>
      <td><f:if condition="{event.location}"><strong class="text-danger">{event.location.name}</strong> • {event.location.street}, {event.location.zip} {event.location.city}<br/></f:if></td>
    </tr>
    <tr>
      <th class="align-top">Summen:</th>
      <td>
        <span class="badge badge-success">{event.ticketsApproved} Gäste</span>
        <f:if condition="{event.programs}"><span class="badge badge-default">{event.programs} Programme</span></f:if>
        <f:if condition="{event.passes}"><span class="badge badge-default">{event.passes} Fotopässe</span></f:if>
      </td>
    </tr>
    <tr>
      <th class="align-top">Status:</th>
      <td>
        <span class="badge badge-success">{event.ticketsReceived} eingecheckt</span>
        <span class="badge badge-warning">{event.ticketsPrepared} ausständig</span>
      </td>
    </tr>
  </table>
</div>
<h3>Gästeliste</h3>
<div class="form-inline mb-4">
    <div class="d-flex flex-column d-md-block">
        <div class="col-12">
            <div class="form-group mb-0 mt-4 mt-md-0 w-100">
                <input placeholder="Suche" class="form-control filter-table noEnterSubmit w-100" data-filter-tbody-id="#guests-to-filter" data-counter-id="#guests-counter" data-counter-label="Gästen" type="search" />
            </div>
        </div>
    </div>
</div>
<table class="table table-striped table-hover" id="guestlist">
  <thead>
    <tr>
      <th data-sort-method="none" width="40px"></th>
      <th data-filterable class="text-center" width="40px"><svg class="icon fill-gold"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#ticket"></use></svg></th>
      <th data-filterable data-sort-default width="auto">Gästeinfos</th>
      <th data-sort-method="none">Check-In Notiz</th>
    </tr>
  </thead>
  <tbody id="guests-to-filter">
    <f:for each="{guests -> v:iterator.sort(sortBy: 'guestOutput.sortName')}" as="accreditation" iteration="i">
    <tr class="{f:if(condition:'{accreditation.ticketsPrepared} <= 0', then:'success')} {f:if(condition:'{accreditation.ticketsPrepared} > 0 && {accreditation.ticketsPrepared} != {accreditation.ticketsApproved}', then:'warning')}">
      <td>
        <f:if condition="{accreditation.ticketsPrepared} <= 0">
          <f:link.action action="checkin" arguments="{accreditation:accreditation}" class="btn btn-default">
            <svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#circle-check"></use></svg>
          </f:link.action>
        </f:if>
        <f:if condition="{accreditation.ticketsPrepared} > 0 && {accreditation.ticketsPrepared} != {accreditation.ticketsApproved}">
          <f:link.action action="checkin" arguments="{accreditation:accreditation}" class="btn btn-default">
            <svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#circle-check"></use></svg>
          </f:link.action>
        </f:if>
        <f:if condition="{accreditation.ticketsPrepared} > 0 && {accreditation.ticketsPrepared} == {accreditation.ticketsApproved}">
          <f:link.action action="checkin" arguments="{accreditation:accreditation}" class="btn btn-default">
            <svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#circle-empty"></use></svg>
          </f:link.action>
        </f:if>
      </td>
      <td class="text-center">{accreditation.ticketsPrepared}</td>
      <td data-sort='{accreditation.guestOutput.sortName}'>
        <span class="badge badge-gold"><f:if condition="{accreditation.facie}"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#user-star"></use></svg></f:if>{accreditation.guestTypeOutput}</span><br>
        <f:render partial="ContactOutput" arguments="{contact:accreditation.guestOutput, uid:accreditation.uid, settings:settings}" />
      </td>
      <td data-sort-method="none">
        <f:format.nl2br>{accreditation.notes}</f:format.nl2br>
        <f:if condition="{accreditation.notesReceived}">
            <div class="alert bg-warning">
                <strong>Check-In-Info</strong><br>
                <f:format.nl2br>{accreditation.notesReceived}</f:format.nl2br>
            </div>
        </f:if>
      </td>
    </tr>
    </f:for>
  </tbody>
</table>
<p style="margin-bottom:80px;">&nbsp;</p>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Akkreditierungsdetails</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Hier wird der Inhalt durch AJAX geladen -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
        </div>
      </div>
    </div>
</div>

</f:section>
</html>





<h3>Gästeliste</h3>
<div class="form-inline mb-4">
    <div class="d-flex flex-column d-md-block">
        <div class="col-12">
            <div class="form-group mb-0 mt-4 mt-md-0 w-100">
                <input placeholder="Suche" class="form-control w-100" data-filter-tbody-id="#guests-to-filter" data-counter-id="#guests-counter" data-counter-label="Gästen" type="search" />
            </div>
        </div>
    </div>
</div>
<table class="table table-striped table-hover" id="guestlist">
  <thead>
    <tr>
      <th data-sort-method="none" width="40px"></th>
      <th data-filterable class="text-center" width="40px"><svg class="icon fill-gold"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#ticket"></use></svg></th>
      <th data-filterable data-sort-default width="auto">Gästeinfos</th>
      <th data-sort-method="none">Check-In Notiz</th>
    </tr>
  </thead>
  <tbody id="guests-to-filter">
    <f:for each="{guests -> v:iterator.sort(sortBy: 'guestOutput.sortName')}" as="accreditation" iteration="i">
    <tr class="{f:if(condition:'{accreditation.ticketsPrepared} <= 0', then:'success')} {f:if(condition:'{accreditation.ticketsPrepared} > 0 && {accreditation.ticketsPrepared} != {accreditation.ticketsApproved}', then:'warning')}">
        <td>
            <button type="button"
                    onclick="openCheckInModal('{accreditation.uid}');"
                    class="btn btn-default" >
                <f:if condition="{accreditation.ticketsPrepared} <= 0">
                    <svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#circle-check"></use></svg>
                </f:if>
                <f:if condition="{accreditation.ticketsPrepared} > 0 && {accreditation.ticketsPrepared} != {accreditation.ticketsApproved}">
                    <svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#circle-check"></use></svg>
                </f:if>
                <f:if condition="{accreditation.ticketsPrepared} > 0 && {accreditation.ticketsPrepared} == {accreditation.ticketsApproved}">
                    <svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#circle-empty"></use></svg>
                </f:if>
            </button>
        </td>
      <td class="text-center">{accreditation.ticketsPrepared}</td>
      <td data-sort='{accreditation.guestOutput.sortName}'>
        <span class="badge badge-gold"><f:if condition="{accreditation.facie}"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#user-star"></use></svg></f:if>{accreditation.guestTypeOutput}</span><br>
        <f:render partial="ContactOutput" arguments="{contact:accreditation.guestOutput, uid:accreditation.uid, settings:settings}" />
      </td>
      <td data-sort-method="none">
        <f:switch expression="{accreditation.event.uid}">
          <f:case value="4271"><div style="font-size: 130%;">{accreditation.seats->f:format.raw()}</div><br></f:case>
        </f:switch>
        <f:format.nl2br>{accreditation.notes}</f:format.nl2br>
        <f:if condition="{accreditation.notesReceived}">
            <div class="alert bg-warning">
                <strong>Check-In-Info</strong><br>
                <f:format.nl2br>{accreditation.notesReceived}</f:format.nl2br>
            </div>
        </f:if>
      </td>
    </tr>
    </f:for>
  </tbody>
</table>
<p style="margin-bottom:80px;">&nbsp;</p>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Akkreditierungsdetails</h4>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Hier wird der Inhalt durch AJAX geladen -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Schließen</button>
        </div>
      </div>
    </div>
</div>

