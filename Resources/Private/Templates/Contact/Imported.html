<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:be="http://typo3.org/ns/TYPO3/CMS/Backend/ViewHelpers"
      xmlns:v="http://typo3.org/ns/FluidTYPO3/Vhs/ViewHelpers"
      v:schemaLocation="https://fluidtypo3.org/schemas/vhs-master.xsd"
      data-namespace-typo3-fluid="true">

<f:layout name="Contacts" />

<f:section name="buttons">
<f:if condition="{mailingList}"><be:link.editRecord uid="{mailingList.uid}" table="sys_category" returnUrl="{be:moduleLink(route: 'allegria_eventcenter', arguments:'{id:2}', query:'&action=list&controller=Contact&tx_publicrelations_eventcenter[mailingList]={mailingList.uid}')}" class="btn btn-sm btn-default"><svg class="icon icon-sm fill-dark mr-2"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#pencil"></use></svg>Kategorie bearbeiten</be:link.editRecord></f:if>
</f:section>

<f:section name="shortcuts">
  <f:link.action controller="Contact" action="imported" class="btn btn-sm btn-default"><svg class="icon icon-sm fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#refresh"></use></svg></f:link.action>
</f:section>

<f:section name="content">
  <f:flashMessages queueIdentifier="allegria.publicrelations.flashMessages" />

  <h1>Importierte Kontakte<small><span class="badge badge-success ml-3">{importedContacts->f:count()} Kontakte gefunden</span></small></h1>

  <f:form action="finisher" enctype="multipart/form-data" name="importedContacts">

  <div class="col-12">
    <div class="btn-group btn-group-sm mb-4" role="group" aria-label="Function Menue">
      <f:form.button type="submit" name="function" value="confirm" class="btn btn-sm btn-success {f:if(condition: '{confirmable}', else: 'disabled')}"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#square-checkbox"></use></svg>Bestätigen</f:form.button>
      <f:form.button type="submit" name="function" value="edit" class="btn btn-sm btn-warning"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#play"></use></svg>Funktionen ausführen</f:form.button>
      <f:form.button type="submit" name="function" value="delete" class="btn btn-sm btn-danger {f:if(condition: '{confirmable}', else: 'disabled')}"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#bin"></use></svg>LÖSCHEN!</f:form.button>
    </div>
  </div>

  <div class="table-fit">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th data-sort-method="none" width="30px"><input type="checkbox" class="checkbox-toggle-all"></th>
        <th>
          <select class="form-control tomselect-generic select-table-toggler" data-toggle-id="function-select">
            <option selected="selected" value="">Bitte wählen…</option>
            <option value="replace">Ersetzen</option>
            <option value="merge">Zusammenführen</option>
            <option value="delete">Löschen!</option>
          </select>
        </th>
        <th></th>
        <th>Kategorien</th>
        <th>Beschreibung</th>
        <th>Geschlecht</th>
        <th>Vorname</th>
        <th>Zweiter Vorname</th>
        <th>Nachname</th>
        <th>per Du</th>
        <th>E-Mail</th>
        <th>Telefon</th>
        <th>Mobil</th>
        <th>Fax</th>
        <th>Medium/Firma</th>
        <th>Position</th>
        <th>Straße</th>
        <th>PLZ</th>
        <th>Ort</th>
        <th>Land</th>
        <th>Web</th>
      </tr>
    </thead>
    <tbody>
    <f:for each="{importedContacts}" as="contact" iteration="cId">
      <tr class="{f:if(condition: '!{contact.duplicates} && {contact.valid} && {contact.categories}', then: 'success')} {f:if(condition: '{contact.duplicates}', then: 'warning')} {f:if(condition: '{contact.valid}', else: 'danger')} {f:if(condition: '{contact.duplicate}', then: 'warning')}">
        <td>
        <f:form.hidden property="{cId.index}.uid" value="{contact.uid}" />
        <f:form.hidden property="{cId.index}.pid" value="{contact.copyToPid}" />

        <f:if condition="{contact.duplicates} || !{contact.valid} || !{contact.categories}">
          <f:then><f:form.checkbox property="{cId.index}.confirmed" value="1" disabled="1" /></f:then>
          <f:else><f:form.checkbox property="{cId.index}.confirmed" value="1" /></f:else>
        </f:if>
        </td>
        <td>
          <f:if condition="{contact.duplicates} || !{contact.categories}">
          <f:form.select class="form-control tomselect-generic" data="{toggle-target: 'function-select'}" id="selectUpdate{cId.index}" property="{cId.index}.edit">
            <f:form.select.option value="" selected="1">Bitte wählen…</f:form.select.option>
            <f:if condition="{contact.categories}">
              <f:form.select.option value="replace">Ersetzen</f:form.select.option>
              <f:form.select.option value="merge">Zusammenführen</f:form.select.option>
            </f:if>
            <f:form.select.option value="delete">Löschen!</f:form.select.option>
          </f:form.select>
          <f:if condition="{contact.duplicates}"><f:form.hidden property="{cId.index}.duplicateUid" value="{contact.duplicates.0.uid}" /></f:if>
          </f:if>
        </td>
        <td>
          <be:link.editRecord uid="{contact.uid}" table="tt_address" returnUrl="{be:moduleLink(route: 'allegria_eventcenter', arguments:'{id:2}', query:'&tx_publicrelations_contacts[action]=imported&tx_publicrelations_contacts[controller]=Contact')}" class="btn btn-default btn-sm"><svg class="icon icon-sm fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#pencil"></use></svg></be:link.editRecord>
          <f:link.action action="finisher" arguments="{function:'delete', uid:contact.uid}" class="btn btn-danger btn-sm"><svg class="icon icon-sm fill-white"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#bin"></use></svg></f:link.action>
        </td>
        <td class="{f:if(condition: '{contact.categories}', else: 'danger')}">
          <f:for each="{contact.categories}" as="category">{category.title}<br></f:for>
        </td>
        <td class="{f:if(condition: '{contact.description}', then: 'info')}">{contact.description->f:sanitize.html()}</td>
        <td>{contact.gender}</td>
        <td>{contact.firstName}</td>
        <td>{contact.secondName}</td>
        <td>{contact.lastName}</td>
        <td>{contact.personally}</td>
        <td>{contact.email}</td>
        <td>{contact.phone}</td>
        <td>{contact.mobile}</td>
        <td>{contact.fax}</td>
        <td>{contact.company}</td>
        <td>{contact.position}</td>
        <td>{contact.address}</td>
        <td>{contact.zip}</td>
        <td>{contact.city}</td>
        <td>{contact.country}</td>
        <td>{contact.www}</td>
      </tr>
      <f:if condition="{contact.duplicates}">
        <f:for each="{contact.duplicates}" as="duplicate">
        <tr class="info">
          <td><svg class="icon fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#axes-two-dimensional"></use></svg></td>
          <td></td>
          <td><be:link.editRecord uid="{duplicate.uid}" table="tt_address" returnUrl="{be:moduleLink(route: 'allegria_eventcenter', arguments:'{id:2}', query:'&tx_publicrelations_contacts[action]=imported&tx_publicrelations_contacts[controller]=Contact')}" class="btn btn-default btn-sm"><svg class="icon icon-sm fill-dark"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#pencil"></use></svg></be:link.editRecord></td>
          <td>
            <f:for each="{duplicate.categories}" as="category">{category.title}<br></f:for>
          </td>
          <td class="{f:if(condition: '{duplicate.description}', then: 'info')}">{duplicate.description->f:sanitize.html()}</td>
          <td>{duplicate.gender}</td>
          <td>{duplicate.firstName}</td>
          <td>{duplicate.secondName}</td>
          <td>{duplicate.lastName}</td>
          <td>{duplicate.personally}</td>
          <td>{duplicate.email}</td>
          <td>{duplicate.phone}</td>
          <td>{duplicate.mobile}</td>
          <td>{duplicate.fax}</td>
          <td>{duplicate.company}</td>
          <td>{duplicate.position}</td>
          <td>{duplicate.address}</td>
          <td>{duplicate.zip}</td>
          <td>{duplicate.city}</td>
          <td>{duplicate.country}</td>
          <td>{duplicate.www}</td>
        </tr>
        </f:for>
      </f:if>
    </f:for>
    </tbody>
  </table>
  </div>

  <div class="col-12">
    <div class="btn-group btn-group-sm" role="group" aria-label="Function Menue">
      <f:form.button type="submit" name="function" value="confirm" class="btn btn-sm btn-success {f:if(condition: '{confirmable}', else: 'disabled')}"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#square-checkbox"></use></svg>Bestätigen</f:form.button>
      <f:form.button type="submit" name="function" value="edit" class="btn btn-sm btn-warning"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#play"></use></svg>Funktionen ausführen</f:form.button>
      <f:form.button type="submit" name="function" value="delete" class="btn btn-sm btn-danger {f:if(condition: '{confirmable}', else: 'disabled')}"><svg class="icon icon-sm fill-white mr-1"><use xlink:href="{f:uri.resource(path:'Images/', extensionName: 'allegria_communications', useCacheBusting: false)}glyphicons-basics.svg#bin"></use></svg>LÖSCHEN!</f:form.button>
    </div>
  </div>

  </f:form>

</f:section>
</html>
